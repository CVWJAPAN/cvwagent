<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>みんなの居場所おあがり（誰でも食堂）</title>
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-ar@0.5.0/dist/aframe-ar.min.js"></script>
    <style>
        body{font-family:Arial,sans-serif;margin:0;padding:20px;text-align:center}
        #welcome-screen,#hub-container{max-width:600px;margin:0 auto;background:#fff;padding:20px;border-radius:10px;text-align:left}
        #hub-container{display:none}
        h1{color:#c71585;font-size:24px}
        h2{color:#c71585;font-size:18px;border-bottom:1px solid #ffe4e1}
        p{font-size:14px;color:#333}
        .button{background:#ff69b4;color:#fff;padding:10px;border:none;border-radius:10px;cursor:pointer}
        .button:hover{background:#ff4f9a}
        #donation-counter,#support-request{border:1px solid #e0e0e0;border-radius:10px;padding:15px;height:100px;overflow-y:scroll}
        input,select{width:calc(100% - 20px);padding:8px;border:1px solid #e0e0e0;border-radius:8px;margin-bottom:10px}
        #ar-section{max-width:600px;margin:20px auto;background:#fff;padding:20px;border-radius:10px;text-align:left}
        a-scene {position: relative; width: 100%; height: 300px; display: block;}
    </style>
</head>
<body>
    <div id="welcome-screen">
        <h1>みんなの居場所おあがり（誰でも食堂）</h1>
        <p>地域住民が集う食事と交流の場を提供します。ハブを始めるボタンを押してください。</p>
        <button class="button" onclick="startHub()">ハブを始める</button>
    </div>
    <div id="hub-container">
        <h1>みんなの居場所おあがり（誰でも食堂）</h1>
        <h2>寄付状況（目標: 50,000,000円）</h2>
        <div id="donation-counter">
            <p>寄付総額: <span id="donation-total">0</span> 円</p>
            <button class="button" onclick="addDonation(500)">500円寄付</button>
            <button class="button" onclick="addDonation(1000)">1000円寄付</button>
        </div>

        <h2>食料支援依頼（別プロジェクト）</h2>
        <p>支援内容は cvwjapan@gmail.com に送信されます。ARでメニュー確認も可能です。</p>
        <form id="support-form" action="https://formspree.io/f/YOUR_FORM_ID" method="POST">
            <input type="text" name="content" id="support-input" placeholder="支援内容（例: 米5kg）">
            <select name="allergy" id="allergy">
                <option value="none">アレルギーなし</option>
                <option value="egg">卵</option>
                <option value="milk">乳製品</option>
                <option value="wheat">小麦</option>
                <option value="other">その他</option>
            </select>
            <input type="text" name="allergy-detail" id="allergy-detail" placeholder="アレルギー詳細（例: ピーナッツ）">
            <input type="text" name="address" id="support-address" placeholder="住所（例: 〒123-4567 東京都XX区）">
            <button type="submit" class="button">依頼</button>
        </form>
        <div id="support-request"></div>

        <h2>ARでメニュー確認</h2>
        <div id="ar-section">
            <p>スマホでHiroマーカーを読み込んでください（<a href="https://github.com/artoolkit/artoolkit5/blob/master/doc/patterns/Hiro.pdf" target="_blank">マーカーPDF</a>）。</p>
            <a-scene embedded arjs="sourceType: webcam;">
                <a-text value="メニュー: 米5kg\nアレルギー: 卵不使用" color="white" position="0 0 -2"></a-text>
                <a-marker-camera preset="hiro"></a-marker-camera>
            </a-scene>
        </div>

        <p><a href="reports.html" class="button">みんなの居場所おあがり（誰でも食堂）の予定・実施報告・収支報告を見る</a></p>
    </div>

    <script>
        function startHub(){
            document.getElementById("welcome-screen").style.display="none";
            document.getElementById("hub-container").style.display="block";
        }

        function addDonation(amount) {
            let total = parseInt(document.getElementById("donation-total").innerText.replace(/,/g, '')) || 0;
            total += amount;
            document.getElementById("donation-total").innerText = total.toLocaleString();
        }

        document.getElementById("support-form").addEventListener("submit", function(event) {
            event.preventDefault();
            const content = document.getElementById("support-input").value.trim();
            const allergy = document.getElementById("allergy").value;
            const allergyDetail = document.getElementById("allergy-detail").value.trim();
            const addr = document.getElementById("support-address").value.trim();
            if (content && addr) {
                const requests = document.getElementById("support-request");
                const item = document.createElement("div");
                const allergyInfo = allergy !== "none" ? `, アレルギー: ${allergy}${allergyDetail ? ` (${allergyDetail})` : ""}` : "";
                item.innerText = `依頼: ${content}, 住所: ${addr}${allergyInfo}`;
                requests.appendChild(item);
                requests.scrollTop = requests.scrollHeight;

                fetch(this.action, {
                    method: "POST",
                    body: new FormData(this),
                    headers: { "Accept": "application/json" }
                }).then(response => {
                    if (response.ok) {
                        alert("申請が cvwjapan@gmail.com に送信されました。");
                        document.getElementById("support-input").value = "";
                        document.getElementById("allergy").value = "none";
                        document.getElementById("allergy-detail").value = "";
                        document.getElementById("support-address").value = "";
                    } else {
                        alert("送信に失敗しました。もう一度お試しください。");
                    }
                }).catch(error => {
                    alert("エラーが発生しました: " + error);
                });
            } else {
                alert("支援内容と住所を入力してください。");
            }
        });
    </script>
</body>
</html>
